plugins {
    id 'com.github.johnrengelman.shadow' version '7.1.2'
}

version '0.0.0'

dependencies {
    implementation project(':api')
    implementation project(':game')

    // Logging and console (safe versions this time)
    implementation 'org.apache.logging.log4j:log4j-api:2.17.2'
    implementation 'org.apache.logging.log4j:log4j-core:2.17.2'
    implementation 'org.apache.logging.log4j:log4j-jul:2.17.2'
    implementation 'org.apache.logging.log4j:log4j-slf4j18-impl:2.17.2'
    implementation 'org.jline:jline-terminal'
    implementation 'org.jline:jline-reader'
    implementation 'net.minecrell:terminalconsoleappender:1.3.0'
    implementation 'org.jline:jline-terminal-jansi:3.21.0'

    implementation 'org.eclipse.jetty:jetty-server:11.0.8'
    implementation 'org.eclipse.jetty:jetty-servlet:11.0.8'
    testImplementation 'org.eclipse.jetty:jetty-servlet:11.0.8'

    implementation 'com.unboundid:unboundid-ldapsdk:6.0.4'

    implementation 'org.ow2.asm:asm:9.2'
    implementation 'org.ow2.asm:asm-commons:9.2'
    implementation 'org.ow2.asm:asm-util:9.2'
}

task copyServerJar(type: Copy) {
    dependsOn(':game:build')
    from('../game/build/libs/') {
        include '*-all.jar'
        rename '.*-all.jar', 'game.jar'
    }
    into 'run'
}

task copySinglePlayerJar(type: Copy) {
    dependsOn(':plugin-singleplayer:build')
    from('../plugin-singleplayer/build/libs/') {
        include '*.jar'
        rename '.*.jar', 'singleplayer.jar'
    }
    into 'run/plugins'
}

test {
    dependsOn(copyServerJar)
    dependsOn(copySinglePlayerJar)
}

jar {
    manifest {
        attributes 'Main-Class' : 'fr.thesmyler.log4shell.Main'
    }
}

build {
    dependsOn(shadowJar)
}